let activeSW,restaurant;var map;let reviews;"serviceWorker"in navigator&&(navigator.serviceWorker.register("/service-worker.js").then(e=>{e.installing&&(activeSW=e.installing).addEventListener("statechange",()=>{"activated"===activeSW.state&&activeSW.postMessage({onlineStatus:navigator.onLine})})}).catch(e=>{}),window.addEventListener("online",e=>{navigator.serviceWorker.controller?navigator.serviceWorker.controller.postMessage({onlineStatus:!0}):activeSW.postMessage({onlineStatus:!0}),notifyUser()}),window.addEventListener("offline",e=>{navigator.serviceWorker.controller?navigator.serviceWorker.controller.postMessage({onlineStatus:!1}):activeSW.postMessage({onlineStatus:!1}),notifyUser()})),notifyUser=(()=>{if("Notification"in window&&("default"===Notification.permission&&Notification.requestPermission(e=>{}),"granted"===Notification.permission)){let e="Network connection: ";navigator.onLine?e+="online!":e+="offline!";const t=new Notification("Online Status",{body:e});setTimeout(t.close.bind(t),4e3)}});const REVIEWS_STR="reviews";window.initMap=(()=>{fetchRestaurantFromURL((e,t)=>{e||(self.map=new google.maps.Map(document.getElementById("map"),{zoom:16,center:t.latlng,scrollwheel:!1}),fillBreadcrumb(),DBHelper.mapMarkerForRestaurant(self.restaurant,self.map))})}),fetchRestaurantFromURL=(e=>{if(self.restaurant)return void e(null,self.restaurant);const t=getParameterByName("id");t?DBHelper.fetchRestaurantById(t,(t,n)=>{self.restaurant=n,n&&(fillRestaurantHTML(),e(null,n))}):(error="No restaurant id in URL",e(error,null))}),fillRestaurantHTML=((e=self.restaurant)=>{document.getElementById("restaurant-name").innerHTML=e.name,document.getElementById("restaurant-address").innerHTML=e.address;const t=document.getElementById("restaurant-img");t.className="restaurant-img",t.src=DBHelper.imageUrlForRestaurant(e),t.alt=e.name,t.setAttribute("aria-label",""),document.getElementById("restaurant-cuisine").innerHTML=e.cuisine_type,e.operating_hours&&fillRestaurantHoursHTML(),fillReviewsHTML()}),fillRestaurantHoursHTML=((e=self.restaurant.operating_hours)=>{const t=document.getElementById("restaurant-hours");for(let n in e){const r=document.createElement("tr"),a=document.createElement("td");a.innerHTML=n,r.appendChild(a);const i=document.createElement("td");i.innerHTML=e[n],r.appendChild(i),t.appendChild(r)}}),fillReviewsHTML=(()=>{const e=`reviews/?restaurant_id=${self.restaurant.id}`;DBHelper.fetchFromServer((e,t)=>{const n=t;e&&(n=null);const r=document.getElementById("reviews-container"),a=document.createElement("h2");a.innerHTML="Reviews",r.appendChild(a);const i=document.createElement("button");if(i.innerHTML="Add Review",i.setAttribute("id","add-review-btn"),r.appendChild(i),!n){const e=document.createElement("p");return e.innerHTML="No reviews yet!",void r.appendChild(e)}const o=document.getElementById("reviews-list");n.forEach(e=>{o.appendChild(createReviewHTML(e))}),r.appendChild(o);const s=document.getElementById("add-review-modal"),l=document.getElementById("add-review-btn"),d=document.getElementsByClassName("close")[0];l.onclick=(()=>{s.style.display="block"}),d.onclick=(()=>{s.style.display="none"}),document.getElementById("review-form").addEventListener("submit",e=>{e.preventDefault(),submitForm(e)})},e)}),submitForm=(e=>{const t={restaurant_id:self.restaurant.id,name:e.path[0][0].value,rating:e.path[0][1].value,comments:e.path[0][2].value};fetch(DBHelper.DATABASE_URL("reviews"),{method:"POST",mode:"cors",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}).then(e=>{if(201===e.status||202===e.status)return document.getElementById("add-review-modal").style.display="none",document.getElementById("review-form").reset(),e.json()}).then(e=>{document.getElementById("reviews-list").appendChild(createReviewHTML(e))}).then(()=>{}).catch(e=>{})}),createReviewHTML=(e=>{const t=document.createElement("li"),n=document.createElement("p");n.innerHTML=e.name,t.appendChild(n);const r=document.createElement("p");r.innerHTML=new Date(e.updatedAt).toDateString(),t.appendChild(r);const a=document.createElement("p");a.innerHTML=`Rating: ${e.rating}`,t.appendChild(a);const i=document.createElement("p");return i.innerHTML=e.comments,t.appendChild(i),t}),fillBreadcrumb=((e=self.restaurant)=>{const t=document.getElementById("breadcrumb"),n=document.createElement("li");n.innerHTML=e.name,t.appendChild(n)}),getParameterByName=((e,t)=>{t||(t=window.location.href),e=e.replace(/[\[\]]/g,"\\$&");const n=new RegExp(`[?&]${e}(=([^&#]*)|&|#|$)`).exec(t);return n?n[2]?decodeURIComponent(n[2].replace(/\+/g," ")):"":null}),getReviewsByRestaurantEndpoint=(()=>{return`reviews/?restaurant_id=${getParameterByName("id")}`});